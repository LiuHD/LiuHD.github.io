---
title: laravel在不同数据库连接间预加载
date: 2018-12-06 18:39:06
tags:
---
如题，laravel中，当使用不同数据库连接的model间进行懒加载时会遇到问题，在早期的版本中必须自己hack，但是新版的laravle已经可以通过配置解决了，只要为两个model分别都指定好connection属性，如

```php
class Book extends BaseModel
{
    protected $connection = 'book';

    public function author() {
        return $this->hasOne(Author::class, 'author_id');
    }
}

class Author extends BaseModel
{
    protected $connection = 'user';
}
```

注，即使是使用的默认数据库连接也要配置上，因为laravel源码里是这么写的: https://github.com/laravel/framework/blob/79f34c859046c3ddecede41377ab2a75e208548b/src/Illuminate/Database/Eloquent/Concerns/HasRelationships.php#L651

只有指明了connection，也就是connection属性不为null才可以使用这个特性。

然后就可以使用

```php
    Book::with('author')
```